<!DOCTYPE html>
<html lang="vi">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Video Dashboard - Admin Panel</title>
		<meta
			name="description"
			content="Administrative dashboard for managing video content and users."
		/>
		<meta name="robots" content="noindex, nofollow" />
		<link rel="stylesheet" href="/styles.css" />
		<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
		<script src="https://telegram.org/js/telegram-web-app.js"></script>
		<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
	</head>
	<body>
		<div id="app">
			<!-- Login Page -->
			<div id="login-page" class="page">
				<div class="login-container">
					<h1>ğŸ¬ Video Dashboard</h1>
					<p class="subtitle">Quáº£n lÃ½ video TikTok</p>

					<div id="login-step-1" class="login-step">
						<label>Telegram ID cá»§a báº¡n:</label>
						<input
							type="text"
							id="telegram-id"
							placeholder="VD: 123456789"
							autocomplete="off"
						/>
						<button onclick="requestOTP()" id="btn-request-otp">
							Gá»­i mÃ£ xÃ¡c thá»±c
						</button>
						<p class="hint">
							ğŸ’¡ Nháº­p ID Telegram cá»§a báº¡n. MÃ£ sáº½ Ä‘Æ°á»£c gá»­i qua bot.
						</p>
					</div>

					<div id="login-step-2" class="login-step hidden">
						<label>Nháº­p mÃ£ OTP:</label>
						<input
							type="text"
							id="otp-code"
							placeholder="000000"
							maxlength="6"
							autocomplete="off"
						/>
						<button onclick="verifyOTP()" id="btn-verify-otp">XÃ¡c nháº­n</button>
						<button onclick="backToStep1()" class="btn-secondary">
							â† Quay láº¡i
						</button>
						<p class="hint">ğŸ“± Kiá»ƒm tra tin nháº¯n tá»« bot Telegram</p>
					</div>

					<div id="login-error" class="error-message hidden"></div>
				</div>
			</div>

			<!-- Dashboard Page -->
			<div id="dashboard-page" class="page hidden">
				<header>
					<div class="header-left">
						<h1>ğŸ¬ Video Dashboard</h1>
						<span id="user-info"></span>
					</div>
					<div class="header-right">
						<button onclick="goToFeed()" class="btn-switch" title="Xem Feed">
							ğŸ“º Feed
						</button>
						<button onclick="refreshVideos()" class="btn-icon" title="LÃ m má»›i">
							ğŸ”„
						</button>
						<button onclick="logout()" class="btn-secondary">ÄÄƒng xuáº¥t</button>
					</div>
				</header>

				<div class="stats-bar">
					<div class="stat">
						<span class="stat-value" id="stat-total">0</span>
						<span class="stat-label">Tá»•ng video</span>
					</div>
					<div class="stat">
						<span class="stat-value" id="stat-pending">0</span>
						<span class="stat-label">Chá» Ä‘Äƒng</span>
					</div>
					<div class="stat">
						<span class="stat-value" id="stat-posted">0</span>
						<span class="stat-label">ÄÃ£ Ä‘Äƒng</span>
					</div>
					<div class="stat" style="border-left: 2px solid var(--danger)">
						<span
							class="stat-value"
							id="stat-duplicates"
							style="color: var(--danger)"
							>0</span
						>
						<span class="stat-label">Video trÃ¹ng</span>
					</div>
				</div>

				<div class="tabs" id="tab-nav">
					<button
						class="tab active"
						data-tab="videos"
						onclick="switchTab('videos')"
					>
						ğŸ¬ Videos
					</button>
					<button
						class="tab admin-only hidden"
						data-tab="users"
						onclick="switchTab('users')"
					>
						ğŸ‘¥ Users
					</button>
					<button
						class="tab admin-only hidden"
						data-tab="audit"
						onclick="switchTab('audit')"
					>
						ğŸ“œ Audit
					</button>
					<button
						class="tab admin-only hidden"
						data-tab="broadcast"
						onclick="switchTab('broadcast')"
					>
						ğŸ“¢ Broadcast
					</button>
					<button
						class="tab admin-only hidden"
						data-tab="chat"
						onclick="switchTab('chat')"
					>
						ğŸ’¬ Chat <span id="chat-badge" class="badge hidden">0</span>
					</button>
					<button
						class="tab admin-only hidden"
						data-tab="channels"
						onclick="switchTab('channels')"
					>
						ğŸ“£ Channels
					</button>
				</div>

				<!-- Videos Tab -->
				<div id="tab-videos" class="tab-content active">
					<div class="filter-bar">
						<input
							type="text"
							id="search-input"
							placeholder="ğŸ” TÃ¬m kiáº¿m..."
							oninput="handleSearch()"
						/>
						<select id="status-filter" onchange="handleStatusFilter()">
							<option value="all">Táº¥t cáº£</option>
							<option value="pending">Chá» Ä‘Äƒng</option>
							<option value="posted">ÄÃ£ Ä‘Äƒng</option>
							<option value="cancelled">Huá»· Ä‘Äƒng</option>
							<option value="duplicates">âš ï¸ Video trÃ¹ng</option>
						</select>
					</div>

					<div id="video-list" class="video-list">
						<!-- Videos will be injected here -->
					</div>

					<div id="pagination-controls" class="pagination-container hidden">
						<!-- Pagination will be dynamically generated -->
					</div>
				</div>

				<!-- Users Tab (Admin Only) -->
				<div id="tab-users" class="tab-content hidden">
					<div class="admin-panel">
						<div class="admin-header">
							<h2>ğŸ‘¥ Quáº£n lÃ½ Users</h2>
							<button onclick="loadUsers()" class="btn-icon">ğŸ”„</button>
						</div>
						<div class="filter-bar">
							<input
								type="text"
								id="users-search"
								placeholder="ğŸ” TÃ¬m user..."
								oninput="handleUsersSearch()"
							/>
							<select id="users-role-filter" onchange="handleUsersFilter()">
								<option value="all">Táº¥t cáº£ role</option>
								<option value="admin">Admin</option>
								<option value="mod">Mod</option>
								<option value="reviewer">Reviewer</option>
								<option value="user">User</option>
							</select>
							<select id="users-sort" onchange="handleUsersFilter()">
								<option value="viewCount-desc">LÆ°á»£t xem â†“</option>
								<option value="viewCount-asc">LÆ°á»£t xem â†‘</option>
								<option value="lastActiveAt-desc">Hoáº¡t Ä‘á»™ng gáº§n Ä‘Ã¢y</option>
								<option value="createdAt-desc">Má»›i nháº¥t</option>
							</select>
						</div>
						<div id="users-list" class="users-list">
							<!-- Users will be rendered here -->
						</div>
						<div id="users-pagination" class="pagination-container"></div>
					</div>
				</div>

				<!-- Audit Tab (Admin Only) -->
				<div id="tab-audit" class="tab-content hidden">
					<div class="admin-panel">
						<div class="admin-header">
							<h2>ğŸ“œ Audit Logs</h2>
							<button onclick="loadAuditLogs()" class="btn-icon">ğŸ”„</button>
						</div>
						<div class="filter-bar">
							<input
								type="text"
								id="audit-search"
								placeholder="ğŸ” TÃ¬m log..."
								oninput="handleAuditSearch()"
							/>
							<select id="audit-action-filter" onchange="handleAuditFilter()">
								<option value="all">Táº¥t cáº£ action</option>
								<!-- Will be populated dynamically -->
							</select>
							<select id="audit-sort" onchange="handleAuditFilter()">
								<option value="desc">Má»›i nháº¥t</option>
								<option value="asc">CÅ© nháº¥t</option>
							</select>
						</div>
						<div id="audit-list" class="audit-list">
							<!-- Audit logs will be rendered here -->
						</div>
						<div id="audit-pagination" class="pagination-container"></div>
					</div>
				</div>

				<!-- Broadcast Tab (Admin Only) -->
				<div id="tab-broadcast" class="tab-content hidden">
					<div class="admin-panel">
						<div class="broadcast-section">
							<div class="admin-header">
								<h2>ğŸ“ Variables</h2>
								<button onclick="openVariableModal()" class="btn-primary">
									+ ThÃªm
								</button>
							</div>
							<div id="variables-list" class="variables-list">
								<!-- Variables will be rendered here -->
							</div>
						</div>

						<div class="broadcast-section">
							<div class="admin-header">
								<h2>ğŸ“‹ Templates</h2>
								<button onclick="openTemplateModal()" class="btn-primary">
									+ Táº¡o má»›i
								</button>
							</div>
							<div id="templates-list" class="templates-list">
								<!-- Templates will be rendered here -->
							</div>
						</div>

						<div class="broadcast-section">
							<div class="admin-header">
								<h2>ğŸ“¤ Tin nháº¯n Ä‘Ã£ gá»­i</h2>
								<button onclick="loadBroadcastMessages()" class="btn-icon">
									ğŸ”„
								</button>
							</div>
							<div id="messages-list" class="messages-list">
								<!-- Sent messages will be rendered here -->
							</div>
						</div>
					</div>
				</div>

				<!-- Chat Tab (Admin Only) -->
				<div id="tab-chat" class="tab-content hidden">
					<div class="admin-panel chat-panel">
						<div class="chat-sidebar">
							<div class="admin-header">
								<h3>Users</h3>
							</div>
							<div id="chat-users-list" class="chat-users-list">
								<!-- User list will be rendered here -->
							</div>
						</div>
						<div class="chat-main">
							<div id="chat-header" class="chat-header">
								<span id="chat-user-name">Chá»n user Ä‘á»ƒ xem tin nháº¯n</span>
							</div>
							<div id="chat-messages" class="chat-messages">
								<!-- Messages will be rendered here -->
							</div>
							<div class="chat-input-area hidden" id="chat-input-area">
								<textarea
									id="chat-reply-input"
									placeholder="Nháº­p tin nháº¯n... (há»— trá»£ {{variable}})"
								></textarea>
								<button onclick="sendChatReply()" class="btn-primary">
									Gá»­i
								</button>
							</div>
						</div>
					</div>
				</div>

				<!-- Channels Tab (Admin Only) -->
				<div id="tab-channels" class="tab-content hidden">
					<div class="admin-panel">
						<div class="admin-header">
							<h2>ğŸ“£ Quáº£n lÃ½ Channels/Groups</h2>
							<div class="header-actions">
								<button
									onclick="loadChannels()"
									class="btn-icon"
									title="Refresh"
								>
									ğŸ”„
								</button>
								<button onclick="openAddChannelModal()" class="btn-primary">
									â• ThÃªm Channel
								</button>
							</div>
						</div>
						<div id="channels-list" class="channels-list">
							<!-- Channels will be rendered here -->
						</div>
					</div>
				</div>

				<!-- Add Channel Modal -->
				<div id="add-channel-modal" class="modal hidden">
					<div class="modal-content modal-medium">
						<button class="modal-close" onclick="closeAddChannelModal()">
							Ã—
						</button>
						<h3>â• ThÃªm Channel/Group</h3>
						<p
							style="
								color: var(--text-muted);
								font-size: 13px;
								margin-bottom: 16px;
							"
						>
							Nháº­p Chat ID (sá»‘ Ã¢m) hoáº·c @username cá»§a channel/group. Bot pháº£i lÃ 
							admin.
						</p>
						<label>Chat ID hoáº·c @username</label>
						<input
							type="text"
							id="add-channel-input"
							placeholder="-1001234567890 hoáº·c @mychannel"
						/>
						<div class="modal-actions">
							<button onclick="addChannel()" class="btn-primary">ThÃªm</button>
							<button onclick="closeAddChannelModal()" class="btn-secondary">
								Há»§y
							</button>
						</div>
					</div>
				</div>

				<!-- Send to Channel Modal -->
				<div id="send-channel-modal" class="modal hidden">
					<div class="modal-content modal-large">
						<button class="modal-close" onclick="closeSendChannelModal()">
							Ã—
						</button>
						<h3 id="send-channel-title">ğŸ“¤ Gá»­i tin nháº¯n</h3>
						<input type="hidden" id="send-channel-id" />

						<label>Ná»™i dung (há»— trá»£ {{variable}})</label>
						<textarea
							id="send-channel-text"
							rows="4"
							placeholder="Ná»™i dung tin nháº¯n..."
						></textarea>

						<div class="form-row">
							<div class="form-col">
								<label>Loáº¡i media</label>
								<select id="send-channel-media-type">
									<option value="">KhÃ´ng cÃ³ media</option>
									<option value="photo">áº¢nh</option>
									<option value="video">Video</option>
									<option value="audio">Audio/Nháº¡c</option>
									<option value="document">File/TÃ i liá»‡u</option>
								</select>
							</div>
							<div class="form-col">
								<label>Upload file</label>
								<input
									type="file"
									id="send-channel-file"
									onchange="handleChannelMediaUpload()"
								/>
							</div>
						</div>
						<input type="hidden" id="send-channel-media-url" />
						<div id="send-channel-media-preview" class="media-preview"></div>

						<label>Buttons (JSON) - TÃ¹y chá»n</label>
						<textarea
							id="send-channel-buttons"
							rows="2"
							placeholder='[{"type": "link", "text": "Xem thÃªm", "value": "https://..."}]'
						></textarea>

						<div class="modal-actions">
							<button onclick="sendToChannel()" class="btn-primary">
								ğŸ“¤ Gá»­i
							</button>
							<button onclick="closeSendChannelModal()" class="btn-secondary">
								Há»§y
							</button>
						</div>
					</div>
				</div>

				<!-- Channel Ban Modal -->
				<div id="channel-ban-modal" class="modal hidden">
					<div class="modal-content modal-medium">
						<button class="modal-close" onclick="closeChannelBanModal()">
							Ã—
						</button>
						<h3>ğŸš« Cháº·n ngÆ°á»i dÃ¹ng</h3>
						<input type="hidden" id="ban-channel-id" />
						<label>Telegram ID cá»§a ngÆ°á»i dÃ¹ng</label>
						<input type="text" id="ban-user-id" placeholder="123456789" />
						<label>LÃ½ do (tÃ¹y chá»n)</label>
						<input type="text" id="ban-reason" placeholder="LÃ½ do cháº·n..." />
						<div class="modal-actions">
							<button onclick="banChannelUser()" class="btn-danger">
								ğŸš« Cháº·n
							</button>
							<button onclick="closeChannelBanModal()" class="btn-secondary">
								Há»§y
							</button>
						</div>
					</div>
				</div>

				<!-- Video Preview Modal -->
				<div id="video-modal" class="modal hidden">
					<div class="modal-content">
						<button class="modal-close" onclick="closeVideoModal()">Ã—</button>
						<video id="modal-video" controls></video>
						<div id="modal-info"></div>
					</div>
				</div>

				<!-- Delete Confirm Modal -->
				<div id="delete-modal" class="modal hidden">
					<div class="modal-content modal-small">
						<h3>âš ï¸ XÃ¡c nháº­n xÃ³a</h3>
						<p id="delete-message"></p>
						<div class="modal-actions">
							<button onclick="confirmDelete()" class="btn-danger">XÃ³a</button>
							<button onclick="closeDeleteModal()" class="btn-secondary">
								Há»§y
							</button>
						</div>
					</div>
				</div>
				<!-- Notification Modal (replaces alert) -->
				<div id="notify-modal" class="modal hidden">
					<div class="modal-content modal-small">
						<div id="notify-icon" class="notify-icon">âœ…</div>
						<h3 id="notify-title">ThÃ´ng bÃ¡o</h3>
						<div id="notify-message" class="notify-message"></div>
						<div class="modal-actions">
							<button onclick="closeNotifyModal()" class="btn-primary">
								OK
							</button>
						</div>
					</div>
				</div>

				<!-- Hashtag Edit Modal (replaces prompt) -->
				<div id="hashtag-modal" class="modal hidden">
					<div class="modal-content modal-small">
						<button class="modal-close" onclick="closeHashtagModal()">Ã—</button>
						<h3>ğŸ·ï¸ Sá»­a Hashtags</h3>
						<textarea
							id="hashtag-input"
							rows="4"
							placeholder="Nháº­p hashtags..."
						></textarea>
						<div class="modal-actions">
							<button onclick="saveHashtags()" class="btn-primary">LÆ°u</button>
							<button onclick="closeHashtagModal()" class="btn-secondary">
								Há»§y
							</button>
						</div>
					</div>
				</div>

				<!-- Content Generator Modal -->
				<div id="generator-modal" class="modal hidden">
					<div class="modal-content modal-large">
						<button class="modal-close" onclick="closeGeneratorModal()">
							Ã—
						</button>
						<div class="generator-header">
							<h3>âœ¨ Generate Title & Tags</h3>
						</div>

						<div id="category-filters">
							<!-- Categories will be loaded dynamically -->
							<p style="color: var(--text-muted)">Loading categories...</p>
						</div>

						<div class="generator-actions">
							<button
								onclick="generateContent()"
								class="btn-generate"
								id="btn-generate"
							>
								âœ¨ Generate
							</button>
							<button onclick="clearCategorySelections()" class="btn-secondary">
								ğŸ”„ Clear Filters
							</button>
						</div>

						<div id="generated-results" class="generated-results">
							<!-- Generated options will appear here -->
						</div>

						<div id="generator-edit" class="generated-edit hidden">
							<label>Title (cÃ³ thá»ƒ chá»‰nh sá»­a)</label>
							<input
								type="text"
								id="generator-title-input"
								placeholder="Title..."
							/>
							<label>Hashtags (cÃ³ thá»ƒ chá»‰nh sá»­a)</label>
							<textarea
								id="generator-hashtags-input"
								rows="2"
								placeholder="Hashtags..."
							></textarea>
							<div class="modal-actions">
								<button onclick="applyGeneratedContent()" class="btn-primary">
									âœ… Ãp dá»¥ng
								</button>
								<button onclick="closeGeneratorModal()" class="btn-secondary">
									Há»§y
								</button>
							</div>
						</div>
					</div>
				</div>

				<!-- User Details Modal -->
				<div id="user-modal" class="modal hidden">
					<div class="modal-content modal-medium">
						<button class="modal-close" onclick="closeUserModal()">Ã—</button>
						<div id="user-modal-content"></div>
					</div>
				</div>

				<!-- Variable Edit Modal -->
				<div id="variable-modal" class="modal hidden">
					<div class="modal-content modal-small">
						<button class="modal-close" onclick="closeVariableModal()">
							Ã—
						</button>
						<h3 id="variable-modal-title">ğŸ“ ThÃªm Variable</h3>
						<input type="hidden" id="variable-edit-id" />
						<label>Key (tÃªn biáº¿n):</label>
						<input
							type="text"
							id="variable-key"
							placeholder="vd: tiktok_link"
						/>
						<label>Value (giÃ¡ trá»‹):</label>
						<input
							type="text"
							id="variable-value"
							placeholder="vd: https://tiktok.com/@channel"
						/>
						<label>MÃ´ táº£ (tÃ¹y chá»n):</label>
						<input
							type="text"
							id="variable-description"
							placeholder="MÃ´ táº£ ngáº¯n..."
						/>
						<div class="modal-actions">
							<button onclick="saveVariable()" class="btn-primary">LÆ°u</button>
							<button onclick="closeVariableModal()" class="btn-secondary">
								Há»§y
							</button>
						</div>
					</div>
				</div>

				<!-- Template Edit Modal -->
				<div id="template-modal" class="modal hidden">
					<div class="modal-content modal-large">
						<button class="modal-close" onclick="closeTemplateModal()">
							Ã—
						</button>
						<h3 id="template-modal-title">ğŸ“‹ Táº¡o Template</h3>
						<input type="hidden" id="template-edit-id" />
						<div class="form-row">
							<div class="form-col">
								<label>TÃªn template:</label>
								<input
									type="text"
									id="template-name"
									placeholder="vd: ChÃ o má»«ng user má»›i"
								/>
							</div>
						</div>
						<label>TiÃªu Ä‘á» (há»— trá»£ {{variable}}):</label>
						<input
							type="text"
							id="template-title"
							placeholder="vd: ChÃ o má»«ng {{user_name}}!"
						/>
						<label>Ná»™i dung (há»— trá»£ {{variable}}, Markdown):</label>
						<textarea
							id="template-content"
							rows="6"
							placeholder="Ná»™i dung tin nháº¯n..."
						></textarea>
						<div class="form-row">
							<div class="form-col">
								<label>Media (áº£nh/video):</label>
								<input
									type="file"
									id="template-media"
									accept="image/*,video/*"
									onchange="handleMediaUpload()"
								/>
								<input type="hidden" id="template-media-url" />
								<input type="hidden" id="template-media-type" />
								<div id="template-media-preview" class="media-preview"></div>
							</div>
						</div>
						<label>Buttons (JSON array):</label>
						<textarea
							id="template-buttons"
							rows="3"
							placeholder='[{"text": "ğŸ‘‰ Xem ngay", "type": "link", "value": "https://..."}]'
						></textarea>
						<p class="hint">
							Types: link (má»Ÿ URL), copy (copy text), callback (telegram
							callback)
						</p>
						<div class="modal-actions">
							<button onclick="saveTemplate()" class="btn-primary">LÆ°u</button>
							<button onclick="previewTemplate()" class="btn-secondary">
								ğŸ‘ï¸ Preview
							</button>
							<button onclick="closeTemplateModal()" class="btn-secondary">
								Há»§y
							</button>
						</div>
					</div>
				</div>

				<!-- Publish Modal -->
				<div id="publish-modal" class="modal hidden">
					<div class="modal-content modal-medium">
						<button class="modal-close" onclick="closePublishModal()">Ã—</button>
						<h3>ğŸ“¢ ÄÄƒng tin</h3>
						<input type="hidden" id="publish-template-id" />
						<p id="publish-template-name"></p>
						
						<div class="publish-targets">
							<div class="publish-target-section">
								<label>Gá»­i Ä‘áº¿n Users:</label>
								<select id="publish-target">
									<option value="">âŒ KhÃ´ng gá»­i cho users</option>
									<option value="all">ğŸŒ Táº¥t cáº£ users</option>
									<option value="user">ğŸ‘¤ User thÆ°á»ng</option>
									<option value="mod">ğŸ“¤ Mod</option>
									<option value="reviewer">ğŸ“ Reviewer</option>
								</select>
							</div>
							
							<div class="publish-target-section">
								<label>Gá»­i Ä‘áº¿n Channels/Groups:</label>
								<div id="publish-channels-list" class="publish-channels-list">
									<!-- Channels will be loaded here -->
								</div>
							</div>
						</div>
						
						<div class="modal-actions">
							<button onclick="publishBroadcast()" class="btn-primary">
								ğŸ“¢ Gá»­i ngay
							</button>
							<button onclick="closePublishModal()" class="btn-secondary">
								Há»§y
							</button>
						</div>
					</div>
				</div>

				<!-- Save Actions Bar -->
				<div id="save-actions" class="save-actions-bar hidden">
					<span>ÄÃ£ chá»n <b id="selected-count">0</b> video</span>
					<button onclick="batchNotify()" id="btn-batch-notify" class="btn-primary" style="margin-right: 8px;">
						ğŸ“¢ Notify
					</button>
					<button onclick="batchDelete()" id="btn-batch-delete" class="btn-danger">
						ğŸ—‘ï¸ XÃ³a
					</button>
					<button onclick="cancelSelection()" class="btn-secondary">
						Há»§y
					</button>
				</div>
			</div>
		</div>

		<script src="/api.js"></script>
		<script src="/app.js"></script>
		<script src="/broadcast.js"></script>
	</body>
</html>
</html>
